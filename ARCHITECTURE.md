# Архитектура работы с v0 Platform API

## Концепция

**Цель:** Каждый пользователь работает со своим проектом в v0.dev, где может итерировать и править компоненты.

## Архитектура решения

### 1. Идентификация пользователя

**Используем Telegram User ID:**
- Telegram Mini App предоставляет `tg.initDataUnsafe.user.id`
- Это уникальный идентификатор пользователя
- Можно использовать для создания/поиска проекта пользователя

### 2. Хранение состояния проекта

**Вариант A: localStorage (простой, но ограниченный)**
- Хранить `projectId` и `chatId` в localStorage
- ✅ Просто
- ❌ Только на одном устройстве
- ❌ Может потеряться при очистке браузера

**Вариант B: Backend база данных (рекомендуется)**
- Хранить `userId -> projectId, chatId` на backend
- ✅ Работает на всех устройствах
- ✅ Надежное хранение
- ❌ Нужна база данных

**Вариант C: Гибридный**
- Пробовать загрузить из backend
- Если нет - создавать новый проект
- Сохранять в backend после создания

### 3. Логика работы

```
Пользователь открывает приложение
    ↓
Получаем Telegram User ID
    ↓
Проверяем: есть ли проект для этого пользователя?
    ↓
    ├─ НЕТ → Создаем новый проект через Platform API
    │         Сохраняем projectId и chatId
    │
    └─ ДА → Используем существующий проект и чат
    ↓
Пользователь отправляет промпт
    ↓
Отправляем сообщение в существующий чат (итерация)
    ↓
Получаем обновленный компонент
    ↓
Отображаем результат
```

### 4. Структура данных

**На backend (если используем БД):**
```json
{
  "userId": "123456789",
  "projectId": "proj_abc123",
  "chatId": "chat_xyz789",
  "createdAt": "2024-01-01T00:00:00Z"
}
```

**В localStorage (если используем локальное хранение):**
```json
{
  "projectId": "proj_abc123",
  "chatId": "chat_xyz789"
}
```

## Лимиты и ограничения

### Нужно проверить в документации v0.dev:
1. **Лимит на количество проектов** - сколько проектов можно создать?
2. **Лимит на количество чатов** - сколько чатов в проекте?
3. **Лимит на количество сообщений** - сколько итераций в чате?
4. **Rate limits** - сколько запросов в минуту/час?

### Стратегии при лимитах:

**Если лимит на проекты:**
- Использовать один общий проект для всех пользователей
- Разделять по чатам (один чат = один пользователь)
- Или использовать один чат с контекстом пользователя

**Если лимит на чаты:**
- Один чат на пользователя
- Или один общий чат с идентификацией в промпте

## Предлагаемая архитектура

### Фаза 1: Простая версия (localStorage)

1. При первом запросе:
   - Создаем проект через Platform API
   - Создаем чат в проекте
   - Сохраняем projectId и chatId в localStorage

2. При последующих запросах:
   - Загружаем projectId и chatId из localStorage
   - Отправляем сообщение в существующий чат (итерация)
   - Получаем обновленный компонент

3. При очистке localStorage:
   - Создаем новый проект (старый останется в v0.dev, но не будет использоваться)

### Фаза 2: Продвинутая версия (Backend + БД)

1. Backend хранит маппинг `userId -> projectId, chatId`
2. При первом запросе создаем проект и сохраняем в БД
3. При последующих запросах загружаем из БД
4. Можно добавить управление проектами (создать новый, переключиться)

## Endpoints v0 Platform API (нужно проверить)

Предположительно:
- `POST /v1/projects` - создать проект
- `GET /v1/projects/{id}` - получить проект
- `POST /v1/projects/{id}/chats` - создать чат
- `POST /v1/projects/{id}/chats/{chatId}/messages` - отправить сообщение (итерация)
- `GET /v1/projects/{id}/chats/{chatId}` - получить чат с историей

## Следующие шаги

1. Изучить документацию v0 Platform API
2. Проверить лимиты
3. Реализовать Фазу 1 (localStorage)
4. При необходимости перейти на Фазу 2 (Backend + БД)

